"use strict";document.addEventListener('DOMContentLoaded',function(){const consentRoot=document.querySelector('.cookie-consent-root'),acceptButtons=document.querySelectorAll('.cookie-consent-accept'),rejectButtons=document.querySelectorAll('.cookie-consent-reject'),cookieConsentPrefix=(consentRoot&&consentRoot.getAttribute('data-cookie-prefix'))||'cookie_consent',preferencesCookieName=`${cookieConsentPrefix}_preferences`,preferencesBtn=document.querySelector('.preferences-btn'),modal=document.querySelector('.cookie-preferences-modal'),modalOverlay=document.querySelector('.cookie-preferences-modal-overlay'),modalClose=document.querySelector('.cookie-preferences-modal-close'),modalSave=document.querySelector('.cookie-preferences-save');if(consentRoot){consentRoot.classList.remove('cookie-consent-hide');if(consentRoot.classList.contains('cookie-disable-interaction')){document.documentElement.classList.add('cookie-disable-interaction')}}const cookieConsent=getCookie(cookieConsentPrefix);if(cookieConsent==='accepted'||cookieConsent==='rejected'){hideConsentBanner()}acceptButtons.forEach(button=>{button.addEventListener('click',()=>{setCookie(cookieConsentPrefix,'accepted',(consentRoot&&consentRoot.getAttribute('data-cookie-lifetime'))||7);const prefs=setAllPreferences(!0);logConsent('accepted',prefs);hideConsentBanner();document.dispatchEvent(new CustomEvent('cookieConsentAccepted'));if(typeof loadCookieCategoriesEnabledServices==='function'){try{loadCookieCategoriesEnabledServices()}catch(e){console.info(e)}}})});rejectButtons.forEach(button=>{button.addEventListener('click',()=>{setCookie(cookieConsentPrefix,'rejected',(consentRoot&&consentRoot.getAttribute('data-reject-lifetime'))||1);const prefs=setAllPreferences(!1);logConsent('rejected',prefs);hideConsentBanner();document.dispatchEvent(new CustomEvent('cookieConsentRejected'))})});function showModal(){if(!modal)return;document.body.classList.add('modal-open');modal.setAttribute('aria-hidden','false');modal.classList.add('is-visible');const savedPreferences=getCookiePreferences();document.querySelectorAll('.cookie-toggle input:not([disabled])').forEach(toggle=>{const category=toggle.dataset.category;toggle.checked=savedPreferences?savedPreferences[category]!==!1:!0})}function hideModal(){if(!modal)return;if(document.activeElement&&modal.contains(document.activeElement)){document.activeElement.blur()}modal.setAttribute('aria-hidden','true');modal.classList.remove('is-visible');document.body.classList.remove('modal-open')}function setAllPreferences(accept){const preferences={};document.querySelectorAll('.cookie-toggle input[data-category]').forEach(toggle=>{preferences[toggle.dataset.category]=toggle.disabled?!0:accept});setCookiePreferences(preferences);return preferences}if(preferencesBtn)preferencesBtn.addEventListener('click',showModal);if(modalOverlay)modalOverlay.addEventListener('click',hideModal);if(modalClose)modalClose.addEventListener('click',hideModal);if(modalSave)modalSave.addEventListener('click',()=>{const preferences={};document.querySelectorAll('.cookie-toggle input[data-category]').forEach(toggle=>{preferences[toggle.dataset.category]=toggle.checked});setCookiePreferences(preferences);setCookie(cookieConsentPrefix,'accepted',(consentRoot&&consentRoot.getAttribute('data-cookie-lifetime'))||7);logConsent('custom',preferences);hideModal();hideConsentBanner();document.dispatchEvent(new CustomEvent('cookiePreferencesSaved',{detail:preferences}));document.dispatchEvent(new CustomEvent('cookieConsentAccepted'));if(typeof loadCookieCategoriesEnabledServices==='function'){try{loadCookieCategoriesEnabledServices()}catch(e){console.info(e)}}});document.addEventListener('keydown',function(e){if(e.key==='Escape'&&modal&&modal.classList.contains('is-visible')){hideModal()}});function setCookie(name,value,days){const date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));const expires="; expires="+date.toUTCString();const secureFlag=location.protocol==='https:'?"; Secure":"";document.cookie=`${name}=${value}; path=/; SameSite=Lax${expires}${secureFlag}`}function getCookie(name){const nameEQ=name+"=";const cookies=document.cookie.split(';');for(let cookie of cookies){cookie=cookie.trim();if(cookie.indexOf(nameEQ)===0){return cookie.substring(nameEQ.length)}}return null}function setCookiePreferences(preferences){const expires=new Date();expires.setTime(expires.getTime()+(365*24*60*60*1000));const secureFlag=location.protocol==='https:'?"; Secure":"";document.cookie=`${preferencesCookieName}=${JSON.stringify(preferences)}; expires=${expires.toUTCString()}; path=/; SameSite=Lax${secureFlag}`}function getCookiePreferences(){const name=`${preferencesCookieName}=`;const decoded=decodeURIComponent(document.cookie);const cookies=decoded.split(';');for(let cookie of cookies){cookie=cookie.trim();if(cookie.indexOf(name)===0){try{return JSON.parse(cookie.substring(name.length))}catch(e){console.warn('Invalid preferences cookie')}}}return null}function logConsent(action,preferences){const csrfToken=document.querySelector('meta[name="csrf-token"]');if(!csrfToken){console.error('Cookie Consent Error: CSRF token meta tag not found. Please ensure <meta name="csrf-token" content="{{ csrf_token() }}"> is present in your layout head.');return}fetch('/cookie-consent/log',{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json','X-CSRF-TOKEN':csrfToken.getAttribute('content')},body:JSON.stringify({action:action,preferences:preferences,url:window.location.href})}).then(response=>{if(!response.ok){return response.text().then(text=>{throw new Error('Network response was not ok: '+response.status+' '+text)})}return response.json()}).then(data=>console.log('Cookie Consent Logged:',data)).catch(e=>console.error('Cookie Consent Log Error:',e))}function hideConsentBanner(){if(consentRoot){consentRoot.classList.add('cookie-consent-hide');document.documentElement.classList.remove('cookie-disable-interaction')}hideModal()}window.getCookie=getCookie;window.getCookiePreferences=getCookiePreferences;function showHideToggleCookiePreferencesModal(){const modal=document.querySelector('.cookie-preferences-modal');if(!modal)return;const isVisible=modal.classList.contains('is-visible');if(isVisible){modal.setAttribute('aria-hidden','true');modal.classList.remove('is-visible');document.body.classList.remove('modal-open')}else{modal.setAttribute('aria-hidden','false');modal.classList.add('is-visible');document.body.classList.add('modal-open');const savedPreferences=window.getCookiePreferences&&window.getCookiePreferences();document.querySelectorAll('.cookie-toggle input:not([disabled])').forEach(toggle=>{const category=toggle.dataset.category;toggle.checked=savedPreferences?savedPreferences[category]!==!1:!0})}}window.showHideToggleCookiePreferencesModal=showHideToggleCookiePreferencesModal;document.addEventListener('click',function(e){if(e.target.classList.contains('showHideToggleCookiePreferencesModal')){e.preventDefault();showHideToggleCookiePreferencesModal()}})});document.head.insertAdjacentHTML('beforeend','<style>.modal-open{overflow:hidden;padding-right:var(--scrollbar-width,0);}</style>');